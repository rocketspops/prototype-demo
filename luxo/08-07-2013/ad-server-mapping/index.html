<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <head profile="http://www.w3.org/2005/10/profile">
    <link rel="icon" type="image/png" href="/prototype-demo/assets/favicon-bc356b4d0ff397697983839a5cfc8c0f.png" />
    <title>Ad Server Mapping</title>
    <link rel="stylesheet" href="/prototype-demo/assets/default-e297bb63a148e2f184c2db33775c130e.css" />
    
      <link rel="stylesheet" href="/prototype-demo/assets/2013-08-07-ad-server-mapping-df9733aa481dfec2768703a6ca607893.css" />  
    
    <script src="/prototype-demo/assets/default-693573586776e46280d011426c3afc4f.js"></script>
    
      <script src="/prototype-demo/assets/d3.v3.min-b1e6a5251c27689580cf5ecec02ff374.js"></script>
    
      <script src="/prototype-demo/assets/2013-08-07-ad-server-mapping-56bd628125e9c5ccff28dce76cba86e0.js"></script>
    
    <script src="//use.typekit.net/ysf1fwm.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47551354-1', 'williamwhited.com');
  ga('send', 'pageview');

</script>

  </head>
  <body>
    <ul class="m-nav">
  
    <li class="m-index-logo">
      <a href="/prototype-demo/">
        <img src="/prototype-demo/assets/logo-57823d22fac6bca07b24bdc6821e00f4.png" alt="" />
        <span>Product Design</span>
      </a>
    </li>
    <li><span class="m-nav-seperator">:</span></li>
    <li><a href="/prototype-demo/luxo-index.html">luxo</a></li>
    <li><span class="m-nav-seperator">:</span></li>
    <li class="active">Ad Server Mapping</li>
  
</ul>


<div class="m-wrapper">
  <div style="width: 445px;">
    <div class="header">
      <a class="header--trigger" href="#">
        <span class="clickable"></span>
      </a>
    </div>
    <div class="overlay">
      <div class="overlay__container">
        <a href="#" class="overlay__close">
          <span class="clickable"></span>
        </a>
        <a href="#" class="overlay__select">
          <span style="left: 20px;" class="clickable"></span>
        </a>
        <div class="overlay__source-wrapper">
          <div class="source-facebook" style="position: relative;">
             <img class="icon-link" src="/prototype-demo/assets/2013-08-07-ad-server-mapping-icon_link-fb26b2e19d211042382620977f124044.png" alt="" />
             <img style="position:relative; left: 58px;" src="/prototype-demo/assets/2013-08-07-ad-server-mapping-source_facebook-cf6e089bcb09209a713098f11fa67bd3.png" alt="" />
             <a class="source-remove" href="#">
               <span>Click + Hold</span>
             </a>
           </div>
        </div>
      </div>
  </div>
  </div>
</div>

<script>

var currentEndAngle;

var width = 25,
    height = 25,
    τ = 2 * Math.PI; // http://tauday.com/tau-manifesto

// An arc function with all values bound except the endAngle. So, to compute an
// SVG path string for a given angle, we pass an object with an endAngle
// property to the `arc` function, and it will return the corresponding string.
var arc = d3.svg.arc()
    .innerRadius(10.5)
    .outerRadius(12.5)
    .startAngle(0);

// Create the SVG container, and apply a transform such that the origin is the
// center of the canvas. This way, we don't need to position arcs individually.
var svg = d3.select(".source-facebook").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")

// Add the background arc, from 0 to 100% (τ).
var background = svg.append("path")
    .datum({endAngle: τ})
    .style("fill", "#ddd")
    .attr("d", arc);

var foreground = svg.append("path")
    .datum({endAngle: 0 * τ})
    .style("fill", "#C30D3D")
    .attr("d", arc);


$('.source-remove').on('mousedown', function(e) { 
  if (e.which===1) {
    foreground.transition()
      .duration(1500)
      .ease('circle-out')
      .call(arcTween, 1 * τ );
  }
});

var eCounter = 0;

$('.source-remove').on('mouseup mouseleave', function(e) { 

  console.log(currentEndAngle);
  console.log(eCounter);
  target = $(this).find('span');

  if (e.which===1) {
    if (currentEndAngle >= 360) {
      $('button').off();
      target.removeClass();
      $(".source-facebook").delay(200).fadeOut(200).fadeIn(200).fadeOut(200, function() { 
        foreground.transition().call(arcTween, 0 * τ ); 
      });
      $('.overlay__select .clickable').delay(600).fadeIn(200);
      eCounter = 0;
    } 
    else {
      eCounter++;
      foreground.transition()
        .duration(1000)
        .ease('linear')
        .call(arcTween, 0 * τ );
      if (eCounter >= 2) { 
        target.addClass('s-help-text');
      }
    }
  }

});

// Creates a tween on the specified transition's "d" attribute, transitioning
// any selected arcs from their current angle to the specified new angle.
function arcTween(transition, newAngle) {

  // The function passed to attrTween is invoked for each selected element when
  // the transition starts, and for each element returns the interpolator to use
  // over the course of transition. This function is thus responsible for
  // determining the starting angle of the transition (which is pulled from the
  // element's bound datum, d.endAngle), and the ending angle (simply the
  // newAngle argument to the enclosing function).
  transition.attrTween("d", function(d) {

    // To interpolate between the two angles, we use the default d3.interpolate.
    // (Internally, this maps to d3.interpolateNumber, since both of the
    // arguments to d3.interpolate are numbers.) The returned function takes a
    // single argument t and returns a number between the starting angle and the
    // ending angle. When t = 0, it returns d.endAngle; when t = 1, it returns
    // newAngle; and for 0 < t < 1 it returns an angle in-between.
    var interpolate = d3.interpolate(d.endAngle, newAngle);
    // The return value of the attrTween is also a function: the function that
    // we want to run for each tick of the transition. Because we used
    // attrTween("d"), the return value of this last function will be set to the
    // "d" attribute at every tick. (It's also possible to use transition.tween
    // to run arbitrary code for every tick, say if you want to set multiple
    // attributes from a single function.) The argument t ranges from 0, at the
    // start of the transition, to 1, at the end.
    return function(t) {

      // Calculate the current arc angle based on the transition time, t. Since
      // the t for the transition and the t for the interpolate both range from
      // 0 to 1, we can pass t directly to the interpolator.
      //
      // Note that the interpolated angle is written into the element's bound
      // data object! This is important: it means that if the transition were
      // interrupted, the data bound to the element would still be consistent
      // with its appearance. Whenever we start a new arc transition, the
      // correct starting angle can be inferred from the data.
      d.endAngle = interpolate(t);
      currentEndAngle = d.endAngle * (180/Math.PI);
      if (currentEndAngle >= 360) {
        $('.s-help-text').text('Release!'); 
      } else {
       $('.s-help-text').text('Click + Hold'); 
      }
      // Lastly, compute the arc path given the updated data! In effect, this
      // transition uses data-space interpolation: the data is interpolated
      // (that is, the end angle) rather than the path string itself.
      // Interpolating the angles in polar coordinates, rather than the raw path
      // string, produces valid intermediate arcs during the transition.
      return arc(d);
    };
  });
}

</script>


    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'centro-dev'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

  </body>
</html>
